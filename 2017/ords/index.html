<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>ORDS tips</title>
<link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-3dkvEK0WLHRJ7/Csr0BZjAWxERc5WH7bdeUya2aXxdU= sha512-+L4yy6FRcDGbXJ9mPG8MT/3UCDzwR9gPeyFNMCtInsol++5m3bk2bXWKdZjvybmohrAsn3Ua5x8gfLnbE1YkOg==" crossorigin="anonymous">
<link rel="stylesheet" href="//writ.cmcenroe.me/1.0.2/writ.min.css">
<link rel="stylesheet" href="/style.css" type="text/css" media="all" />
<link rel="alternate" href="/rss.xml" type="application/rss+xml" title="RSS" />
<meta name="author" content="Mark Sta Ana">
<meta name="description" content="Personal website of Mark Sta Ana, aged 7 3/4."/>
<meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" /> 

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101141559-1', 'auto');
  ga('send', 'pageview');

</script>

  </head>
<body data-route=>
  <nav class="menu">
  <a class="menu-item " href="/about/">booyaa</a>
  <a class="menu-item " href="/">blog</a>
  <a class="menu-item" href="/search/">search</a>
  <a class="menu-item" href="/archive/">archive</a>
  <a class="menu-item icon" href="http://github.com/booyaa"><i class="fa fa-github"></i></a>
  <a class="menu-item icon" href="http://twitter.com/booyaa"><i class="fa fa-twitter"></i></a>
  <a class="menu-item icon" href="/rss.xml"><i class="fa fa-rss"></i></a>
  <hr>
</nav>

  <main>
    <article>
      <h1>ORDS tips</h1>
       
      
      
      								
          
    	 

			<time pubdate="pubdate">Jul 13, 2017 - Reading time: 2 minutes.</time><br />
      
      <h2>XML over ORDS</h2>
<p>Turns out you can emit XML via ORDS. I'll assume you have a working ORDS install and the schema is already enabled</p>
<pre><code class="language-plsql">BEGIN
  ORDS.DEFINE_MODULE(
      p_module_name    =&gt; 'reporting',
      p_base_path      =&gt; '/reporting/',
      p_items_per_page =&gt;  0,
      p_status         =&gt; 'PUBLISHED',
      p_comments       =&gt; NULL);      
  ORDS.DEFINE_TEMPLATE(
      p_module_name    =&gt; 'reporting',
      p_pattern        =&gt; 'hello_xml',
      p_priority       =&gt; 0,
      p_etag_type      =&gt; 'HASH',
      p_etag_query     =&gt; NULL,
      p_comments       =&gt; NULL);
  ORDS.DEFINE_HANDLER(
      p_module_name    =&gt; 'reporting',
      p_pattern        =&gt; 'hello_xml',
      p_method         =&gt; 'GET',
      p_source_type    =&gt; 'plsql/block',
      p_items_per_page =&gt;  0,
      p_mimes_allowed  =&gt; '',
      p_comments       =&gt; NULL,
      p_source         =&gt; 
'DECLARE
    l_clob   CLOB;
BEGIN
    SELECT
        ''&lt;xml&gt;hello world&lt;/xml&gt;''
    INTO
        l_clob
    FROM
        dual;

    owa_util.mime_header(
        ccontent_type   =&gt; ''text/xml'',
        bclose_header   =&gt; true,
        ccharset        =&gt; ''ISO-8859-4''
    );

    htp.print(l_clob);
END;'
      );
  COMMIT; 
END;
</code></pre>
<pre><code class="language-shell">$ curl -v http://oracle.rocks:8080/ords/scott/reporting/mime_works
* About to connect() to oracle.rocks port 8080 (#0)
*   Trying 1.2.3.4... connected
* Connected to oracle.rocks (1.2.3.4) port 8080 (#0)
&gt; GET /ords/scott/reporting/mime_works HTTP/1.1
&gt; User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.27.1 zlib/1.2.3 libidn/1.18 libssh2/1.4.2
&gt; Host: oracle.rocks:8080
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/xml; charset=ISO-8859-4
&lt; ETag: &quot;WaloI8WDL3PY2G0ZN6+I8C+c0FxVaUBuDc/v7LKXTpE6dTuJR1s2bLF/0hqW2fVzaXNYpr9TFXqucyoq6dO2Xw==&quot;
&lt; Transfer-Encoding: chunked
&lt;
&lt;xml&gt;hello world&lt;/xml&gt;
* Connection #0 to host oracle.rocks left intact
* Closing connection #0
</code></pre>
<p>Important item of note is the mime header, it's important that <code>bclose_header</code> is always <code>true</code> because this is literally the last HTTP header before the response body. Setting this to false will result in no data.</p>
<h3>References</h3>
<ul>
<li><a href="https://oracle-base.com/articles/misc/oracle-rest-data-services-ords-create-basic-rest-web-services-using-plsql#stored-procedure-xml">ORACLE-BASE</a></li>
</ul>

    </article>
    <br /><br />
    <a href="https://twitter.com/share" class="twitter-share-button" data-show-count="false">Tweet</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </main>
  <footer>
  <hr>
  <p>
    <a href="/license/">CC BY-SA 4.0 / MIT</a>
    -
    <a href="https://github.com/cobalt-org/cobalt.rs">Built with Cobalt</a>
  </p>
  <br>
</footer>

</body>
</html>
